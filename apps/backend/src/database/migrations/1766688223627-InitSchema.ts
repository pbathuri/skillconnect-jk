import { MigrationInterface, QueryRunner } from "typeorm";

export class InitSchema1766688223627 implements MigrationInterface {
    name = 'InitSchema1766688223627'

    public async up(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`CREATE TYPE "public"."training_providers_status_enum" AS ENUM('pending_approval', 'approved', 'suspended', 'rejected', 'inactive')`);
        await queryRunner.query(`CREATE TYPE "public"."training_providers_accreditation_type_enum" AS ENUM('ncvet', 'nsdc', 'state', 'ssc')`);
        await queryRunner.query(`CREATE TABLE "training_providers" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "name" character varying(255) NOT NULL, "legal_name" character varying(255) NOT NULL, "registration_number" character varying(100) NOT NULL, "status" "public"."training_providers_status_enum" NOT NULL DEFAULT 'pending_approval', "accreditation_type" "public"."training_providers_accreditation_type_enum", "accreditation_number" character varying, "accreditation_valid_until" date, "email" character varying NOT NULL, "phone" character varying(15) NOT NULL, "website" character varying, "address_line1" character varying NOT NULL, "address_line2" character varying, "city" character varying NOT NULL, "district" character varying NOT NULL, "state" character varying NOT NULL DEFAULT 'Jammu and Kashmir', "pin_code" character varying(6) NOT NULL, "bank_account_number" character varying NOT NULL, "bank_ifsc" character varying NOT NULL, "bank_name" character varying NOT NULL, "bank_branch" character varying NOT NULL, "gst_number" character varying, "pan_number" character varying NOT NULL, "completion_rate" numeric(5,2) NOT NULL DEFAULT '0', "certification_rate" numeric(5,2) NOT NULL DEFAULT '0', "placement_rate" numeric(5,2) NOT NULL DEFAULT '0', "total_guarantee_claims" integer NOT NULL DEFAULT '0', "total_guarantee_amount_claimed" numeric(12,2) NOT NULL DEFAULT '0', "last_audit_date" date, "audit_score" numeric(5,2), "compliance_violations" integer NOT NULL DEFAULT '0', "tp_score" numeric(5,2), "tp_score_components" jsonb, "tp_score_updated_at" TIMESTAMP WITH TIME ZONE, "guarantee_deposit_amount" numeric(12,2) NOT NULL DEFAULT '0', "guarantee_deposit_percentage" numeric(5,2) NOT NULL DEFAULT '25', "available_guarantee_balance" numeric(12,2) NOT NULL DEFAULT '0', "total_learners_enrolled" integer NOT NULL DEFAULT '0', "total_learners_certified" integer NOT NULL DEFAULT '0', "total_learners_placed" integer NOT NULL DEFAULT '0', "total_loans_disbursed" numeric(14,2) NOT NULL DEFAULT '0', "max_batch_capacity" integer NOT NULL DEFAULT '50', "current_active_batches" integer NOT NULL DEFAULT '0', "sectors" jsonb NOT NULL DEFAULT '[]', "primary_contact_user_id" uuid, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_11384769a7dbc0390376e311acf" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_6151a4096ce3c5e8c689966d2c" ON "training_providers" ("registration_number") `);
        await queryRunner.query(`CREATE TYPE "public"."courses_status_enum" AS ENUM('draft', 'pending_approval', 'approved', 'active', 'inactive', 'archived')`);
        await queryRunner.query(`CREATE TYPE "public"."courses_sector_enum" AS ENUM('it_ites', 'electronics', 'tourism_hospitality', 'healthcare', 'retail', 'manufacturing', 'agriculture', 'handicrafts', 'beauty_wellness', 'apparel', 'other')`);
        await queryRunner.query(`CREATE TYPE "public"."courses_mode_enum" AS ENUM('offline', 'online', 'hybrid')`);
        await queryRunner.query(`CREATE TYPE "public"."courses_skill_level_enum" AS ENUM('beginner', 'intermediate', 'advanced')`);
        await queryRunner.query(`CREATE TABLE "courses" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "name" character varying(255) NOT NULL, "course_code" character varying(50) NOT NULL, "description" text NOT NULL, "short_description" character varying(500), "status" "public"."courses_status_enum" NOT NULL DEFAULT 'draft', "sector" "public"."courses_sector_enum" NOT NULL, "mode" "public"."courses_mode_enum" NOT NULL DEFAULT 'offline', "skill_level" "public"."courses_skill_level_enum" NOT NULL DEFAULT 'beginner', "duration_weeks" integer NOT NULL, "hours_per_week" integer NOT NULL DEFAULT '40', "total_hours" integer NOT NULL, "course_fee" numeric(10,2) NOT NULL, "registration_fee" numeric(10,2) NOT NULL DEFAULT '0', "exam_fee" numeric(10,2) NOT NULL DEFAULT '0', "material_fee" numeric(10,2) NOT NULL DEFAULT '0', "total_fee" numeric(10,2) NOT NULL, "min_age" integer NOT NULL DEFAULT '18', "max_age" integer NOT NULL DEFAULT '35', "min_education" character varying, "prerequisites" jsonb NOT NULL DEFAULT '[]', "certification_body" character varying, "certification_name" character varying, "is_ncvet_aligned" boolean NOT NULL DEFAULT false, "nsqf_level" integer, "job_demand_index" numeric(5,2) NOT NULL DEFAULT '50', "average_placement_salary" numeric(10,2), "placement_rate" numeric(5,2), "curriculum" jsonb NOT NULL DEFAULT '[]', "milestones" jsonb NOT NULL DEFAULT '[]', "batch_size" integer NOT NULL DEFAULT '30', "min_batch_size" integer NOT NULL DEFAULT '10', "thumbnail_url" character varying, "syllabus_url" character varying, "brochure_url" character varying, "name_hi" character varying, "name_ur" character varying, "name_ks" character varying, "description_hi" text, "description_ur" text, "description_ks" text, "total_enrollments" integer NOT NULL DEFAULT '0', "total_completions" integer NOT NULL DEFAULT '0', "average_rating" numeric(3,2) NOT NULL DEFAULT '0', "total_reviews" integer NOT NULL DEFAULT '0', "training_provider_id" uuid NOT NULL, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), "approved_by" character varying, "approved_at" TIMESTAMP WITH TIME ZONE, CONSTRAINT "UQ_b842812430f192167d10f9f99d3" UNIQUE ("course_code"), CONSTRAINT "PK_3f70a487cc718ad8eda4e6d58c9" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_889f2701163f86b2faf62a6247" ON "courses" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_46b1537d4d668f30f3d669dbf9" ON "courses" ("sector") `);
        await queryRunner.query(`CREATE TYPE "public"."banks_status_enum" AS ENUM('active', 'inactive', 'suspended')`);
        await queryRunner.query(`CREATE TYPE "public"."banks_type_enum" AS ENUM('psu', 'private', 'cooperative', 'small_finance', 'regional_rural')`);
        await queryRunner.query(`CREATE TABLE "banks" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "name" character varying(255) NOT NULL, "bank_code" character varying(20) NOT NULL, "status" "public"."banks_status_enum" NOT NULL DEFAULT 'active', "type" "public"."banks_type_enum" NOT NULL DEFAULT 'psu', "email" character varying NOT NULL, "phone" character varying(15) NOT NULL, "website" character varying, "head_office_address" character varying NOT NULL, "city" character varying NOT NULL, "state" character varying NOT NULL, "pin_code" character varying(6) NOT NULL, "api_base_url" character varying, "api_key_encrypted" character varying, "api_secret_encrypted" character varying, "webhook_url" character varying, "webhook_secret_encrypted" character varying, "mclr_rate" numeric(5,2) NOT NULL DEFAULT '8.5', "max_loan_amount" numeric(12,2) NOT NULL DEFAULT '150000', "min_loan_amount" numeric(12,2) NOT NULL DEFAULT '5000', "max_tenure_months" integer NOT NULL DEFAULT '84', "min_tenure_months" integer NOT NULL DEFAULT '36', "min_borrower_score" integer NOT NULL DEFAULT '50', "min_tp_score" integer NOT NULL DEFAULT '50', "cgfssd_registered" boolean NOT NULL DEFAULT true, "cgfssd_member_id" character varying, "total_loans_disbursed" integer NOT NULL DEFAULT '0', "total_amount_disbursed" numeric(14,2) NOT NULL DEFAULT '0', "total_outstanding" numeric(14,2) NOT NULL DEFAULT '0', "npa_rate" numeric(5,2) NOT NULL DEFAULT '0', "nodal_officer_name" character varying, "nodal_officer_email" character varying, "nodal_officer_phone" character varying, "is_api_integrated" boolean NOT NULL DEFAULT false, "integration_status" character varying, "last_api_sync" TIMESTAMP WITH TIME ZONE, "psl_category" character varying NOT NULL DEFAULT 'education', "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "UQ_824dd9d33e9228917f28fc6e052" UNIQUE ("bank_code"), CONSTRAINT "PK_3975b5f684ec241e3901db62d77" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_824dd9d33e9228917f28fc6e05" ON "banks" ("bank_code") `);
        await queryRunner.query(`CREATE TYPE "public"."disbursements_status_enum" AS ENUM('pending', 'milestone_verified', 'bank_initiated', 'completed', 'failed', 'reversed')`);
        await queryRunner.query(`CREATE TYPE "public"."disbursements_type_enum" AS ENUM('milestone', 'device', 'refund_to_learner', 'refund_to_bank')`);
        await queryRunner.query(`CREATE TABLE "disbursements" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "loan_id" uuid NOT NULL, "status" "public"."disbursements_status_enum" NOT NULL DEFAULT 'pending', "type" "public"."disbursements_type_enum" NOT NULL DEFAULT 'milestone', "milestone_number" integer NOT NULL, "milestone_name" character varying NOT NULL, "milestone_percentage" numeric(5,2) NOT NULL, "amount" numeric(12,2) NOT NULL, "recipient_type" character varying NOT NULL, "recipient_id" character varying NOT NULL, "recipient_account_number" character varying NOT NULL, "recipient_ifsc" character varying NOT NULL, "recipient_name" character varying NOT NULL, "transaction_reference" character varying, "bank_reference_number" character varying, "utr_number" character varying, "course_completion_at_disbursement" numeric(5,2), "attendance_at_disbursement" numeric(5,2), "verified_by" character varying, "verified_at" TIMESTAMP WITH TIME ZONE, "initiated_at" TIMESTAMP WITH TIME ZONE, "completed_at" TIMESTAMP WITH TIME ZONE, "failed_at" TIMESTAMP WITH TIME ZONE, "failure_reason" character varying, "retry_count" integer NOT NULL DEFAULT '0', "escrow_reference" character varying, "escrow_balance_before" numeric(12,2), "escrow_balance_after" numeric(12,2), "notes" text, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_2f9ea0e5b8382113aaa3e51cdfa" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_965e5142d018ff6e15929cdc84" ON "disbursements" ("transaction_reference") WHERE "transaction_reference" IS NOT NULL`);
        await queryRunner.query(`CREATE INDEX "IDX_418e2dd3e58c516999f0276b78" ON "disbursements" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_21300446ebc96c0be3826afb3f" ON "disbursements" ("loan_id") `);
        await queryRunner.query(`CREATE TYPE "public"."repayments_status_enum" AS ENUM('scheduled', 'pending', 'processing', 'completed', 'failed', 'partial', 'overdue', 'waived')`);
        await queryRunner.query(`CREATE TYPE "public"."repayments_payment_method_enum" AS ENUM('upi_autopay', 'upi_manual', 'neft', 'rtgs', 'imps', 'nach', 'cash', 'cheque', 'guarantee_claim', 'cgfssd_claim')`);
        await queryRunner.query(`CREATE TABLE "repayments" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "loan_id" uuid NOT NULL, "status" "public"."repayments_status_enum" NOT NULL DEFAULT 'scheduled', "emi_number" integer NOT NULL, "is_step_up_emi" boolean NOT NULL DEFAULT false, "principal_component" numeric(10,2) NOT NULL, "interest_component" numeric(10,2) NOT NULL, "emi_amount" numeric(10,2) NOT NULL, "late_fee" numeric(10,2) NOT NULL DEFAULT '0', "total_due" numeric(10,2) NOT NULL, "amount_paid" numeric(10,2) NOT NULL DEFAULT '0', "outstanding_after_payment" numeric(12,2), "due_date" date NOT NULL, "grace_period_end" date, "payment_method" "public"."repayments_payment_method_enum", "payment_date" TIMESTAMP WITH TIME ZONE, "transaction_reference" character varying, "utr_number" character varying, "bank_reference" character varying, "autopay_attempt_count" integer NOT NULL DEFAULT '0', "last_autopay_attempt" TIMESTAMP WITH TIME ZONE, "autopay_failure_reason" character varying, "days_overdue" integer NOT NULL DEFAULT '0', "reminder_sent" boolean NOT NULL DEFAULT false, "reminder_sent_at" TIMESTAMP WITH TIME ZONE, "tp_guarantee_claimed" numeric(10,2) NOT NULL DEFAULT '0', "cgfssd_claimed" numeric(10,2) NOT NULL DEFAULT '0', "waiver_amount" numeric(10,2) NOT NULL DEFAULT '0', "waiver_reason" character varying, "waived_by" character varying, "notes" text, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_7f297f77b60d1cbfe1d48ec4afa" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_233d5ed2f311ae619af7ab1f20" ON "repayments" ("due_date") `);
        await queryRunner.query(`CREATE INDEX "IDX_f0b333757e165f8cdef5b9f495" ON "repayments" ("status") `);
        await queryRunner.query(`CREATE INDEX "IDX_979b22fe9d2bdcfb49e200ac09" ON "repayments" ("loan_id") `);
        await queryRunner.query(`CREATE TYPE "public"."loans_status_enum" AS ENUM('draft', 'submitted', 'under_review', 'documents_pending', 'kyc_pending', 'kyc_verified', 'bank_submitted', 'bank_approved', 'bank_rejected', 'active', 'disbursement_in_progress', 'fully_disbursed', 'in_moratorium', 'in_repayment', 'delinquent', 'npa', 'closed', 'written_off', 'cancelled')`);
        await queryRunner.query(`CREATE TYPE "public"."loans_purpose_enum" AS ENUM('course_fee', 'course_fee_and_device', 'certification')`);
        await queryRunner.query(`CREATE TABLE "loans" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "application_number" character varying NOT NULL, "status" "public"."loans_status_enum" NOT NULL DEFAULT 'draft', "purpose" "public"."loans_purpose_enum" NOT NULL DEFAULT 'course_fee', "learner_id" uuid NOT NULL, "course_id" uuid NOT NULL, "training_provider_id" uuid NOT NULL, "bank_id" uuid, "bank_application_id" character varying, "bank_loan_account_number" character varying, "requested_amount" numeric(12,2) NOT NULL, "approved_amount" numeric(12,2), "disbursed_amount" numeric(12,2) NOT NULL DEFAULT '0', "outstanding_principal" numeric(12,2) NOT NULL DEFAULT '0', "outstanding_interest" numeric(12,2) NOT NULL DEFAULT '0', "total_repaid" numeric(12,2) NOT NULL DEFAULT '0', "device_amount" numeric(10,2) NOT NULL DEFAULT '0', "interest_rate" numeric(5,2), "mclr_rate" numeric(5,2), "spread_rate" numeric(5,2), "borrower_score_at_application" numeric(5,2), "tp_score_at_application" numeric(5,2), "risk_category" character varying, "tenure_months" integer, "moratorium_months" integer NOT NULL DEFAULT '3', "emi_amount" numeric(10,2), "step_up_emi_amount" numeric(10,2), "total_emis" integer, "emis_paid" integer NOT NULL DEFAULT '0', "current_milestone" integer NOT NULL DEFAULT '0', "milestone_progress" jsonb NOT NULL DEFAULT '[]', "course_completion_percentage" numeric(5,2) NOT NULL DEFAULT '0', "attendance_percentage" numeric(5,2) NOT NULL DEFAULT '0', "assessment_score" numeric(5,2), "is_certified" boolean NOT NULL DEFAULT false, "certification_date" date, "is_placed" boolean NOT NULL DEFAULT false, "placement_date" date, "placement_employer" character varying, "placement_salary" numeric(10,2), "cgfssd_covered" boolean NOT NULL DEFAULT true, "cgfssd_coverage_percentage" numeric(5,2) NOT NULL DEFAULT '75', "tp_guarantee_amount" numeric(12,2), "upi_mandate_id" character varying, "upi_mandate_status" character varying, "upi_vpa" character varying, "application_date" TIMESTAMP WITH TIME ZONE, "approval_date" TIMESTAMP WITH TIME ZONE, "course_start_date" date, "course_end_date" date, "moratorium_end_date" date, "first_emi_date" date, "last_emi_date" date, "closure_date" TIMESTAMP WITH TIME ZONE, "days_past_due" integer NOT NULL DEFAULT '0', "consecutive_missed_emis" integer NOT NULL DEFAULT '0', "total_missed_emis" integer NOT NULL DEFAULT '0', "has_cosigner" boolean NOT NULL DEFAULT false, "cosigner_name" character varying, "cosigner_aadhaar" character varying, "cosigner_phone" character varying, "documents" jsonb NOT NULL DEFAULT '[]', "submitted_by" character varying, "reviewed_by" character varying, "approved_by" character varying, "rejection_reason" text, "notes" text, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "UQ_a31e396a960bb5c177c4a5c60c2" UNIQUE ("application_number"), CONSTRAINT "PK_5c6942c1e13e4de135c5203ee61" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_a31e396a960bb5c177c4a5c60c" ON "loans" ("application_number") `);
        await queryRunner.query(`CREATE INDEX "IDX_f2e89be6bd90bed0dc1ee6242a" ON "loans" ("learner_id") `);
        await queryRunner.query(`CREATE INDEX "IDX_a630540e1bb9644436a2258c3d" ON "loans" ("status") `);
        await queryRunner.query(`CREATE TYPE "public"."learner_profiles_education_level_enum" AS ENUM('below_10th', '10th', '12th', 'diploma', 'graduate', 'post_graduate')`);
        await queryRunner.query(`CREATE TYPE "public"."learner_profiles_income_range_enum" AS ENUM('below_1l', '1l_to_3l', '3l_to_5l', 'above_5l', 'not_disclosed')`);
        await queryRunner.query(`CREATE TABLE "learner_profiles" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "user_id" uuid NOT NULL, "education_level" "public"."learner_profiles_education_level_enum", "school_name" character varying, "highest_qualification_year" integer, "baseline_assessment_score" numeric(5,2), "prior_certifications" jsonb NOT NULL DEFAULT '[]', "income_range" "public"."learner_profiles_income_range_enum" NOT NULL DEFAULT 'not_disclosed', "family_income_range" character varying, "has_bank_account" boolean NOT NULL DEFAULT false, "has_previous_loans" boolean NOT NULL DEFAULT false, "credit_bureau_score" integer, "existing_loan_amount" numeric(12,2), "career_goals" text, "preferred_sectors" jsonb NOT NULL DEFAULT '[]', "preferred_locations" jsonb NOT NULL DEFAULT '[]', "willing_to_relocate" boolean NOT NULL DEFAULT false, "documents_submitted_at" TIMESTAMP WITH TIME ZONE, "enrollment_completion_time_hours" integer, "orientation_completed" boolean NOT NULL DEFAULT false, "orientation_score" numeric(5,2), "engagement_score" numeric(5,2), "endorsements" jsonb NOT NULL DEFAULT '[]', "is_employed" boolean NOT NULL DEFAULT false, "current_employer" character varying, "employment_type" character varying, "years_of_experience" numeric(4,1), "guardian_name" character varying, "guardian_phone" character varying, "guardian_relation" character varying, "guardian_income_range" character varying, "borrower_score" numeric(5,2), "borrower_score_components" jsonb, "borrower_score_updated_at" TIMESTAMP WITH TIME ZONE, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "REL_94cd9a55d9923c7f859e683c05" UNIQUE ("user_id"), CONSTRAINT "PK_d5c5325dd0d1716cf414f357c08" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE TYPE "public"."users_role_enum" AS ENUM('learner', 'training_provider', 'bank_officer', 'admin', 'super_admin')`);
        await queryRunner.query(`CREATE TYPE "public"."users_status_enum" AS ENUM('pending_verification', 'active', 'suspended', 'inactive')`);
        await queryRunner.query(`CREATE TYPE "public"."users_kyc_status_enum" AS ENUM('not_initiated', 'pending', 'verified', 'rejected')`);
        await queryRunner.query(`CREATE TABLE "users" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "firstName" character varying(100) NOT NULL, "lastName" character varying(100) NOT NULL, "email" character varying(255) NOT NULL, "phone" character varying(15), "password_hash" character varying NOT NULL, "role" "public"."users_role_enum" NOT NULL DEFAULT 'learner', "status" "public"."users_status_enum" NOT NULL DEFAULT 'pending_verification', "kyc_status" "public"."users_kyc_status_enum" NOT NULL DEFAULT 'not_initiated', "aadhaar_number" character varying(12), "aadhaar_verified" boolean NOT NULL DEFAULT false, "pan_number" character varying(10), "digilocker_id" character varying, "address_line1" character varying, "address_line2" character varying, "city" character varying, "district" character varying, "state" character varying, "pin_code" character varying(6), "date_of_birth" date, "gender" character varying, "profile_photo_url" character varying, "preferred_language" character varying NOT NULL DEFAULT 'en', "bank_account_number" character varying, "bank_ifsc" character varying, "bank_name" character varying, "refresh_token" character varying, "last_login" TIMESTAMP WITH TIME ZONE, "failed_login_attempts" integer NOT NULL DEFAULT '0', "locked_until" TIMESTAMP WITH TIME ZONE, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "UQ_97672ac88f789774dd47f7c8be3" UNIQUE ("email"), CONSTRAINT "PK_a3ffb1c0c8416b9fc6f907b7433" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_ba8bc4b1cac001f365d7663497" ON "users" ("aadhaar_number") WHERE "aadhaar_number" IS NOT NULL`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_875541f7dbe1b8565414f9f80b" ON "users" ("phone") WHERE "phone" IS NOT NULL`);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_97672ac88f789774dd47f7c8be" ON "users" ("email") `);
        await queryRunner.query(`CREATE TYPE "public"."notifications_type_enum" AS ENUM('loan_submitted', 'loan_approved', 'loan_rejected', 'documents_pending', 'kyc_verified', 'milestone_reached', 'disbursement_initiated', 'disbursement_completed', 'emi_reminder', 'emi_due_today', 'emi_overdue', 'emi_received', 'autopay_failed', 'course_started', 'attendance_low', 'assessment_scheduled', 'assessment_result', 'certification_achieved', 'tp_milestone_verification', 'tp_payment_received', 'tp_guarantee_claim', 'system_alert', 'policy_update', 'account_update')`);
        await queryRunner.query(`CREATE TYPE "public"."notifications_priority_enum" AS ENUM('low', 'medium', 'high', 'urgent')`);
        await queryRunner.query(`CREATE TYPE "public"."notifications_channels_enum" AS ENUM('in_app', 'sms', 'email', 'push', 'whatsapp')`);
        await queryRunner.query(`CREATE TABLE "notifications" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "user_id" character varying NOT NULL, "type" "public"."notifications_type_enum" NOT NULL, "priority" "public"."notifications_priority_enum" NOT NULL DEFAULT 'medium', "title" character varying(255) NOT NULL, "message" text NOT NULL, "title_hi" character varying, "title_ur" character varying, "title_ks" character varying, "message_hi" text, "message_ur" text, "message_ks" text, "channels" "public"."notifications_channels_enum" array NOT NULL DEFAULT '{in_app}', "read" boolean NOT NULL DEFAULT false, "read_at" TIMESTAMP WITH TIME ZONE, "delivery_status" jsonb NOT NULL DEFAULT '{}', "related_entity_type" character varying, "related_entity_id" character varying, "action_url" character varying, "metadata" jsonb, "scheduled_for" TIMESTAMP WITH TIME ZONE, "expires_at" TIMESTAMP WITH TIME ZONE, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_6a72c3c0f683f6462415e653c3a" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_77ee7b06d6f802000c0846f3a5" ON "notifications" ("created_at") `);
        await queryRunner.query(`CREATE INDEX "IDX_f8b7ed75170d2d7dca4477cc94" ON "notifications" ("read") `);
        await queryRunner.query(`CREATE INDEX "IDX_aef1c7aef3725068e5540f8f00" ON "notifications" ("type") `);
        await queryRunner.query(`CREATE INDEX "IDX_9a8a82462cab47c73d25f49261" ON "notifications" ("user_id") `);
        await queryRunner.query(`CREATE TYPE "public"."attendance_status_enum" AS ENUM('present', 'absent', 'late', 'excused', 'holiday')`);
        await queryRunner.query(`CREATE TABLE "attendance" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "loan_id" uuid NOT NULL, "learner_id" character varying NOT NULL, "course_id" character varying NOT NULL, "training_provider_id" character varying NOT NULL, "batch_id" character varying, "date" date NOT NULL, "status" "public"."attendance_status_enum" NOT NULL DEFAULT 'absent', "check_in_time" TIME, "check_out_time" TIME, "hours_attended" numeric(4,2), "module_id" character varying, "session_name" character varying, "verification_method" character varying, "verification_data" jsonb, "recorded_by" character varying, "remarks" character varying, "synced_at" TIMESTAMP WITH TIME ZONE, "offline_record" boolean NOT NULL DEFAULT false, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_ee0ffe42c1f1a01e72b725c0cb2" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_ff05fd5159e6d9d99514d46531" ON "attendance" ("date") `);
        await queryRunner.query(`CREATE UNIQUE INDEX "IDX_0a5df5e1ed22517ebdeb256c91" ON "attendance" ("loan_id", "date") `);
        await queryRunner.query(`CREATE TYPE "public"."assessments_type_enum" AS ENUM('baseline', 'module', 'midterm', 'final', 'certification', 'practical')`);
        await queryRunner.query(`CREATE TYPE "public"."assessments_status_enum" AS ENUM('scheduled', 'in_progress', 'completed', 'passed', 'failed', 'absent', 'rescheduled')`);
        await queryRunner.query(`CREATE TABLE "assessments" ("id" uuid NOT NULL DEFAULT uuid_generate_v4(), "loan_id" uuid NOT NULL, "learner_id" character varying NOT NULL, "course_id" character varying NOT NULL, "training_provider_id" character varying NOT NULL, "type" "public"."assessments_type_enum" NOT NULL, "status" "public"."assessments_status_enum" NOT NULL DEFAULT 'scheduled', "name" character varying(255) NOT NULL, "description" text, "module_id" character varying, "module_name" character varying, "scheduled_date" date NOT NULL, "scheduled_time" TIME, "duration_minutes" integer, "actual_date" date, "max_score" numeric(6,2) NOT NULL DEFAULT '100', "passing_score" numeric(6,2) NOT NULL DEFAULT '40', "obtained_score" numeric(6,2), "percentage" numeric(5,2), "grade" character varying, "certification_body" character varying, "certificate_number" character varying, "certificate_url" character varying, "certificate_issued_date" date, "attempt_number" integer NOT NULL DEFAULT '1', "max_attempts" integer NOT NULL DEFAULT '3', "evaluated_by" character varying, "evaluated_at" TIMESTAMP WITH TIME ZONE, "evaluator_remarks" text, "answer_sheet_url" character varying, "practical_evidence_urls" jsonb NOT NULL DEFAULT '[]', "weightage" numeric(5,2) NOT NULL DEFAULT '1', "remarks" text, "created_at" TIMESTAMP NOT NULL DEFAULT now(), "updated_at" TIMESTAMP NOT NULL DEFAULT now(), CONSTRAINT "PK_a3442bd80a00e9111cefca57f6c" PRIMARY KEY ("id"))`);
        await queryRunner.query(`CREATE INDEX "IDX_44e86abcddcbf3cbdb90502c69" ON "assessments" ("type") `);
        await queryRunner.query(`CREATE INDEX "IDX_4d97265ade757a76ecae49e43d" ON "assessments" ("loan_id") `);
        await queryRunner.query(`ALTER TABLE "training_providers" ADD CONSTRAINT "FK_289b4979f7960e857a409b61c2e" FOREIGN KEY ("primary_contact_user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "courses" ADD CONSTRAINT "FK_5cd102175febff670cd55888b9e" FOREIGN KEY ("training_provider_id") REFERENCES "training_providers"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "disbursements" ADD CONSTRAINT "FK_21300446ebc96c0be3826afb3fc" FOREIGN KEY ("loan_id") REFERENCES "loans"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "repayments" ADD CONSTRAINT "FK_979b22fe9d2bdcfb49e200ac09e" FOREIGN KEY ("loan_id") REFERENCES "loans"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "loans" ADD CONSTRAINT "FK_f2e89be6bd90bed0dc1ee6242aa" FOREIGN KEY ("learner_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "loans" ADD CONSTRAINT "FK_e1395e9e5ad89cdca32a01b2db0" FOREIGN KEY ("course_id") REFERENCES "courses"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "loans" ADD CONSTRAINT "FK_df6e01fb9e9089c6fbe0036713b" FOREIGN KEY ("training_provider_id") REFERENCES "training_providers"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "loans" ADD CONSTRAINT "FK_585c03978a50e283d589c375987" FOREIGN KEY ("bank_id") REFERENCES "banks"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "learner_profiles" ADD CONSTRAINT "FK_94cd9a55d9923c7f859e683c051" FOREIGN KEY ("user_id") REFERENCES "users"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "attendance" ADD CONSTRAINT "FK_909b0a65dbced5e85afb589d182" FOREIGN KEY ("loan_id") REFERENCES "loans"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
        await queryRunner.query(`ALTER TABLE "assessments" ADD CONSTRAINT "FK_4d97265ade757a76ecae49e43dd" FOREIGN KEY ("loan_id") REFERENCES "loans"("id") ON DELETE NO ACTION ON UPDATE NO ACTION`);
    }

    public async down(queryRunner: QueryRunner): Promise<void> {
        await queryRunner.query(`ALTER TABLE "assessments" DROP CONSTRAINT "FK_4d97265ade757a76ecae49e43dd"`);
        await queryRunner.query(`ALTER TABLE "attendance" DROP CONSTRAINT "FK_909b0a65dbced5e85afb589d182"`);
        await queryRunner.query(`ALTER TABLE "learner_profiles" DROP CONSTRAINT "FK_94cd9a55d9923c7f859e683c051"`);
        await queryRunner.query(`ALTER TABLE "loans" DROP CONSTRAINT "FK_585c03978a50e283d589c375987"`);
        await queryRunner.query(`ALTER TABLE "loans" DROP CONSTRAINT "FK_df6e01fb9e9089c6fbe0036713b"`);
        await queryRunner.query(`ALTER TABLE "loans" DROP CONSTRAINT "FK_e1395e9e5ad89cdca32a01b2db0"`);
        await queryRunner.query(`ALTER TABLE "loans" DROP CONSTRAINT "FK_f2e89be6bd90bed0dc1ee6242aa"`);
        await queryRunner.query(`ALTER TABLE "repayments" DROP CONSTRAINT "FK_979b22fe9d2bdcfb49e200ac09e"`);
        await queryRunner.query(`ALTER TABLE "disbursements" DROP CONSTRAINT "FK_21300446ebc96c0be3826afb3fc"`);
        await queryRunner.query(`ALTER TABLE "courses" DROP CONSTRAINT "FK_5cd102175febff670cd55888b9e"`);
        await queryRunner.query(`ALTER TABLE "training_providers" DROP CONSTRAINT "FK_289b4979f7960e857a409b61c2e"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_4d97265ade757a76ecae49e43d"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_44e86abcddcbf3cbdb90502c69"`);
        await queryRunner.query(`DROP TABLE "assessments"`);
        await queryRunner.query(`DROP TYPE "public"."assessments_status_enum"`);
        await queryRunner.query(`DROP TYPE "public"."assessments_type_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_0a5df5e1ed22517ebdeb256c91"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_ff05fd5159e6d9d99514d46531"`);
        await queryRunner.query(`DROP TABLE "attendance"`);
        await queryRunner.query(`DROP TYPE "public"."attendance_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_9a8a82462cab47c73d25f49261"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_aef1c7aef3725068e5540f8f00"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_f8b7ed75170d2d7dca4477cc94"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_77ee7b06d6f802000c0846f3a5"`);
        await queryRunner.query(`DROP TABLE "notifications"`);
        await queryRunner.query(`DROP TYPE "public"."notifications_channels_enum"`);
        await queryRunner.query(`DROP TYPE "public"."notifications_priority_enum"`);
        await queryRunner.query(`DROP TYPE "public"."notifications_type_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_97672ac88f789774dd47f7c8be"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_875541f7dbe1b8565414f9f80b"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_ba8bc4b1cac001f365d7663497"`);
        await queryRunner.query(`DROP TABLE "users"`);
        await queryRunner.query(`DROP TYPE "public"."users_kyc_status_enum"`);
        await queryRunner.query(`DROP TYPE "public"."users_status_enum"`);
        await queryRunner.query(`DROP TYPE "public"."users_role_enum"`);
        await queryRunner.query(`DROP TABLE "learner_profiles"`);
        await queryRunner.query(`DROP TYPE "public"."learner_profiles_income_range_enum"`);
        await queryRunner.query(`DROP TYPE "public"."learner_profiles_education_level_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_a630540e1bb9644436a2258c3d"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_f2e89be6bd90bed0dc1ee6242a"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_a31e396a960bb5c177c4a5c60c"`);
        await queryRunner.query(`DROP TABLE "loans"`);
        await queryRunner.query(`DROP TYPE "public"."loans_purpose_enum"`);
        await queryRunner.query(`DROP TYPE "public"."loans_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_979b22fe9d2bdcfb49e200ac09"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_f0b333757e165f8cdef5b9f495"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_233d5ed2f311ae619af7ab1f20"`);
        await queryRunner.query(`DROP TABLE "repayments"`);
        await queryRunner.query(`DROP TYPE "public"."repayments_payment_method_enum"`);
        await queryRunner.query(`DROP TYPE "public"."repayments_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_21300446ebc96c0be3826afb3f"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_418e2dd3e58c516999f0276b78"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_965e5142d018ff6e15929cdc84"`);
        await queryRunner.query(`DROP TABLE "disbursements"`);
        await queryRunner.query(`DROP TYPE "public"."disbursements_type_enum"`);
        await queryRunner.query(`DROP TYPE "public"."disbursements_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_824dd9d33e9228917f28fc6e05"`);
        await queryRunner.query(`DROP TABLE "banks"`);
        await queryRunner.query(`DROP TYPE "public"."banks_type_enum"`);
        await queryRunner.query(`DROP TYPE "public"."banks_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_46b1537d4d668f30f3d669dbf9"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_889f2701163f86b2faf62a6247"`);
        await queryRunner.query(`DROP TABLE "courses"`);
        await queryRunner.query(`DROP TYPE "public"."courses_skill_level_enum"`);
        await queryRunner.query(`DROP TYPE "public"."courses_mode_enum"`);
        await queryRunner.query(`DROP TYPE "public"."courses_sector_enum"`);
        await queryRunner.query(`DROP TYPE "public"."courses_status_enum"`);
        await queryRunner.query(`DROP INDEX "public"."IDX_6151a4096ce3c5e8c689966d2c"`);
        await queryRunner.query(`DROP TABLE "training_providers"`);
        await queryRunner.query(`DROP TYPE "public"."training_providers_accreditation_type_enum"`);
        await queryRunner.query(`DROP TYPE "public"."training_providers_status_enum"`);
    }

}
